<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Id="*" Name="VSCode Custom Installer" Language="1033" Version="1.0.0.0" Manufacturer="MyCompany" UpgradeCode="4f63a60c-8958-4990-9cad-af6357b8da8c">
    <Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />

    <MediaTemplate />

    <!-- Directory hierarchy -->
    <Directory Id="TARGETDIR" Name="SourceDir">
      <!-- Program Files x86 -->
      <Directory Id="ProgramFilesFolder">
        <Directory Id="VSCodeInstallDir" Name="Microsoft VS Code"/>
      </Directory>

      <!-- User profile AppData for VS Code settings -->
      <Directory Id="AppDataFolder">
        <Directory Id="CodeUserDir" Name="Code">
          <Directory Id="CodeConfigDir" Name="User"/>
        </Directory>
      </Directory>
    </Directory>

    <!-- VS Code Installer EXE -->
    <DirectoryRef Id="VSCodeInstallDir">
      <Component Id="VSCodeInstallerComponent" Guid="d53785a0-fd10-4c7b-81b6-6c19d1d5361b">
        <File Id="VSCodeSetupExe" Source="Files\vscode-installer.exe" KeyPath="yes" />
      </Component>
    </DirectoryRef>

<DirectoryRef Id="CodeConfigDir">
  <Component Id="CodeConfigDirComponent" Guid="f485e380-3a0d-4b92-8dd6-e5e24205ff5d">
    <RegistryValue Root="HKCU"
                   Key="Software\MyCompany\VSCodeCustom"
                   Name="CodeConfigDirKey"
                   Type="string"
                   Value="1"
                   KeyPath="yes"/>
    <File Id="SettingsJson" Source="Files\settings.json"/>
    <File Id="KeybindingsJson" Source="Files\keybindings.json"/>
    <!-- Remove the directory (including subfolders) on uninstall -->
    <RemoveFolder Id="RemoveCodeConfigDir" Directory="CodeConfigDir" On="uninstall"/>
  </Component>
</DirectoryRef>

<DirectoryRef Id="CodeUserDir">
  <Component Id="CodeUserDirComponent" Guid="b4c06d83-f7f3-4d5c-a754-d8b054c86d13">
    <RegistryValue Root="HKCU"
                   Key="Software\MyCompany\VSCodeCustom"
                   Name="CodeUserDirKey"
                   Type="string"
                   Value="1"
                   KeyPath="yes"/>
    <!-- Remove the CodeUserDir folder itself (after subfolders are removed) -->
    <RemoveFolder Id="RemoveCodeUserDir" Directory="CodeUserDir" On="uninstall"/>
  </Component>
</DirectoryRef>

    <!-- Feature tree -->
    <Feature Id="MainFeature" Title="VSCode Custom Installer" Level="1">
      <ComponentRef Id="VSCodeInstallerComponent"/>
      <ComponentRef Id="CodeUserDirComponent"/>
      <ComponentRef Id="CodeConfigDirComponent"/>
    </Feature>

  </Product>
</Wix>

